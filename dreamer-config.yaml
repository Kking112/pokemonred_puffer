# DreamerV3 specific configuration for Pokemon Red
# Based on config.yaml with dreamer-optimized settings

# Include base configuration
defaults:
  - config
wandb:
  entity: neocodes_dev-neocodes
  project: Pokemon_Red_RL
  group: ~

# Override with DreamerV3 specific settings
dreamer:
  algorithm: 'dreamerv3'
  
  # Replay buffer - adjust based on available RAM
  replay_capacity: 2_000_000
  sequence_length: 50
  batch_size: 16
  prefill_steps: 5000
  
  # Environment settings
  num_envs: 8  # Use 8 parallel environments for better data diversity
  collect_interval: 200  # Collect more steps between training
  
  # Text encoder
  text_embed_dim: 128
  text_num_heads: 4
  text_num_layers: 2
  text_output_dim: 128
  
  # World model architecture - optimized for RTX 5090
  deter_dim: 1024  # Larger deterministic state for complex game
  stoch_dim: 32
  stoch_classes: 32
  hidden_dim: 512
  encoder_dim: 512
  
  # World model training
  world_model_lr: 1e-4
  world_model_train_steps: 2  # More training steps per iteration
  kl_weight: 1.0
  kl_balance: 0.8
  free_nats: 1.0
  
  # Actor-critic
  actor_hidden_dim: 512
  actor_num_layers: 2
  critic_hidden_dim: 512
  critic_num_layers: 2
  num_critics: 3  # Larger ensemble for stability
  
  # Actor-critic training
  actor_lr: 3e-5
  critic_lr: 3e-5
  actor_critic_train_steps: 2
  imagination_horizon: 15
  discount: 0.997
  lambda_: 0.95
  entropy_coef: 3e-4
  
  # Training
  grad_clip: 100.0
  use_amp: True
  num_iterations: 100_000
  
  # Logging
  log_interval: 10
  checkpoint_interval: 500
  checkpoint_dir: 'checkpoints/dreamerv3'

env:
  gb_path: red.gb
  # If true, run without rendering every step.
  headless: True
  # Directory to store video output.
  video_dir: video
  # Directory with pyboy save states to load from.
  state_dir: pyboy_states
  # File within state dir to load from.
  init_state: Bulbasaur
  # How many ticks each environment step should take.
  action_freq: 24
  # Maximum number of steps per mini-episode.
  max_steps: 19816
  # If true, save videos.
  save_video: False
  # If true, save sped up videos.
  fast_video: False
  # Number of environments to save videos for.
  n_record: 10
  # If true, give all party members max base stats.
  perfect_ivs: False
  # If true, downsample the screen observation by 2.
  reduce_res: True
  # If true, losslessy compress the screen observation.
  two_bit: True
  # How many steps until the environment returns an info.
  log_frequency: 2000
  # If true, disable the need for Flash.
  auto_flash: True
  # If true, disable wild encounters with repels.
  disable_wild_encounters: False
  # If true, disable AI input. Useful for debugging.
  disable_ai_actions: False
  # If true, teach cut if possible.
  auto_teach_cut: False
  # If true, use cut when standing next to a tree.
  auto_use_cut: False
  # If true, use strength when walking into a cave if possible.
  auto_use_strength: True
  # If true, use surf when attempting to walk on water.
  auto_use_surf: True
  # If true, teach surf if possible.
  auto_teach_surf: True
  # If true, teach strength if possible.
  auto_teach_strength: True
  # If true, solve a strength puzzle if next to a moveable boulder.
  auto_solve_strength_puzzles: True
  # If true, toss all unneeded items when the bag is full.
  auto_remove_all_nonuseful_items: True
  # If true, use Pokeflute when next to a Snorlax if possible.
  auto_pokeflute: True
  # If true, go to the next floor module num floors when entering an elevator.
  auto_next_elevator_floor: False
  # If true, automatically give the player the GOLD TEETH and HM03.
  # The player will not be allowed in the Safari Zone.
  skip_safari_zone: False
  # If true, the player will have no cap on the number of steps when in the
  # Safari Zone
  infinite_safari_steps: False
  # If true, place a Lemonade in the player's bag if there is no Lemonade when
  # in the Celadon Mart.
  insert_saffron_guard_drinks: False
  # If true, give the player infinite money.
  infinite_money: True
  # If true, all Party Pokemon will have a fixed HP of 128.
  infinite_health: False
  # If true, use the global map observation.
  use_global_map: False
  # If true, provide the PyBoy save state as a part of infos.
  save_state: True
  # If true, animate scripts. Script animations will not be a part of obs.
  # This flag is good for debugging.
  animate_scripts: False
  # The value on the exploration map for visiting a new coordinate.
  exploration_inc: 1.0
  # The max possible value on the exploration map.
  exploration_max: 1.0
  # The amount to scale max steps by. Will be multiplied by the number of required items and events.
  max_steps_scaling: 0 # 0.2 # every 10 events or items gained, multiply max_steps by 2
  # The scaling for visiting important map IDs.
  map_id_scalefactor: 9.539340019226074 # multiply map ids whose events have not been completed by 10
  # How many agents must reach a required event before all agents are allowed to continue.
  # If an agent reaches a milestone and the required tolerance is not met, the episode will reset. 
  required_tolerance: null
  # required_tolerance: 0.02